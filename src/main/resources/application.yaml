spring:
  application:
    name: FFA
  
  # Lazy initialization for faster startup (beans are created on-demand)
  # Disabled for Swagger compatibility - Swagger needs all controllers initialized
  main:
    lazy-initialization: false
  
  # Database Configuration
  datasource:
    url: jdbc:postgresql://ep-polished-paper-agj3ybh6-pooler.c-2.eu-central-1.aws.neon.tech/neondb?sslmode=require
    username: neondb_owner
    password: npg_BbMam0r6Yxzn
    driver-class-name: org.postgresql.Driver
    # Optimize connection pool for faster startup
    hikari:
      # Minimum idle connections (reduce for faster startup)
      minimum-idle: 2
      # Maximum pool size (reduce for lower memory)
      maximum-pool-size: 5
      # Connection timeout (ms)
      connection-timeout: 30000
      # Idle timeout (ms)
      idle-timeout: 600000
      # Max lifetime (ms)
      max-lifetime: 1800000
      # Leak detection threshold (ms) - disable for production
      leak-detection-threshold: 0

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    # Optimize Flyway for faster startup
    validate-on-migrate: false  # Skip validation to speed up startup
    clean-disabled: true
    # Reduce checksum validation
    validate-migration-naming: false
    # Disable placeholder replacement if not needed
    placeholder-replacement: false
    # Suppress PostgreSQL version warning (PostgreSQL 17 works fine, just not officially tested)
    # This is a harmless warning - Flyway will work correctly with PostgreSQL 17
  
  # JPA Configuration
  jpa:
    hibernate:
#      ddl-auto: none  # Disable auto DDL for faster startup (use Flyway instead)
    ddl-auto: update
    show-sql: false  # Disable SQL logging in production to save memory
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: false  # Disable SQL formatting to save memory
        # Disable second-level cache to save memory
        cache.use_second_level_cache: false
        cache.use_query_cache: false
        # Optimize Hibernate for faster startup
        jdbc.batch_size: 20
        order_inserts: true
        order_updates: true
        # Disable unnecessary Hibernate features
        jdbc.use_get_generated_keys: true
        # Disable statistics (not needed in production)
        generate_statistics: false
        # Disable JMX (not needed)
        jmx_enabled: false
    open-in-view: false
    # Delay JPA initialization
    defer-datasource-initialization: false
  
  # File Upload Configuration
  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 10MB

# MyBatis-Plus Configuration
mybatis-plus:
  # Mapper XML file location
  mapper-locations: classpath*:/mapper/**/*.xml
  # Entity class package path
  type-aliases-package: com.isep.ffa.entity
  # Global configuration
  global-config:
    # Database field camel case conversion
    db-config:
      # Primary key type
      id-type: auto
      # Logical delete field
      logic-delete-field: isDeleted
      # Logical delete value
      logic-delete-value: true
      # Logical not-delete value
      logic-not-delete-value: false
      # Field strategy
      field-strategy: not_null
      # Table name prefix
      table-prefix: ""
    # Enable SQL performance analysis
    banner: false
  # Native configuration
  configuration:
    # Enable automatic camel case naming convention mapping
    map-underscore-to-camel-case: true
    # Enable MyBatis second-level cache
    cache-enabled: false
    # Disable SQL logging in production to save memory
    # log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  
  # Security Configuration
  security:
    user:
      name: admin
      password: admin

# JWT Configuration
app:
  cors:
    allowed-origins: "http://localhost:3000,http://localhost:8080,https://localhost:3000,https://ffa-aj0b.onrender.com,https://ffa-api.isep.fr"
  api-base-urls: "http://localhost:8080/ffaAPI,https://ffa-aj0b.onrender.com/ffaAPI"
  jwt:
    secret: 6e8ce58b17be462e3a64de52b87c8e6e5c49739d75fc1472c0a35f4c1f809c3e1d57da6de197d4a8face5320cc5aa2329ee499aee127b0ee4f1ed38e350cb8c6
    expiration: 86400000  # 24 hours in milliseconds
    refresh-expiration: 604800000  # 7 days in milliseconds
  file:
    upload-dir: uploads
    max-size: 10485760  # 10MB in bytes
    allowed-types: "application/pdf,image/jpeg,image/png,image/jpg,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"

# Server Configuration
server:
  port: ${PORT:8080}
  servlet:
    context-path: /ffaAPI
    # Optimize server for faster startup
    session:
      timeout: 30m
      cookie:
        http-only: true
  # Disable unnecessary features for faster startup
  compression:
    enabled: false  # Disable compression to save CPU on startup
  error:
    include-stacktrace: never
    include-message: never
  # Optimize Tomcat for faster startup
  tomcat:
    threads:
      min-spare: 5  # Reduce minimum threads
      max: 50  # Reduce maximum threads
    accept-count: 50  # Reduce accept count
    max-connections: 200  # Reduce max connections
    connection-timeout: 20000  # Reduce connection timeout
    # Disable unnecessary features
    mbeanregistry:
      enabled: false  # Disable JMX registry

# Swagger/OpenAPI Configuration
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    persist-authorization: true
    try-it-out-enabled: true
    operations-sorter: method
    # Lazy load Swagger UI for faster startup
    enabled: true
  show-actuator: true
  # Cache API docs for faster startup
  cache:
    disabled: false
  # Disable lazy initialization to avoid 500 errors on first API docs access
  # lazy-initialization: true
  # Ensure Swagger UI works with context path
  use-management-port: false

# Logging Configuration
# Reduced logging levels for production to save memory
logging:
  level:
    root: INFO
    com.isep.ffa: INFO
    # Enable DEBUG for Swagger/OpenAPI to troubleshoot 500 errors
    org.springdoc: DEBUG
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
    org.springframework.web: WARN
    org.apache.tomcat: WARN
    # Suppress HandlerMappingIntrospector cache miss warnings (harmless, occurs once on first Swagger UI access)
    org.springframework.web.servlet.handler.HandlerMappingIntrospector: ERROR
    # Enable error logging for exception handlers
    com.isep.ffa.controller.GlobalExceptionHandler: DEBUG

# JWT Configuration
jwt:
  secret: mySecretKey123456789012345678901234567890
  expiration: 86400000 # 24 hours in milliseconds

# Actuator Configuration (optimize for faster startup)
management:
  endpoints:
    web:
      exposure:
        # Only expose health endpoint (minimal for faster startup)
        include: health
      # Disable base path for faster startup
      base-path: /actuator
  endpoint:
    health:
      # Simplify health checks
      probes:
        enabled: false
  # Disable JMX (not needed)
  jmx:
    exposure:
      exclude: "*"
  # Disable metrics collection (optional, can enable if needed)
  metrics:
    export:
      enabled: false
